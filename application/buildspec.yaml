
---
version: 0.2
phases:
    install:
        runtime-versions:
            python: 3.7
    build:
        commands:
          - cd $CODEBUILD_SRC_DIR
          - echo "Starting build `date` in `pwd`"
          - wget -o https://files.pythonhosted.org/packages/6d/f1/c69d53593eb92a5e5382fa2101cd9ae861936c6a428092605b4257336171/cryptography-2.9.1-cp35-abi3-manylinux2010_x86_64.whl application/lambda/auth/cryptography-2.9.1-cp35-abi3-manylinux2010_x86_64.whl
          - unzip application/lambda/auth/cryptography-2.9.1-cp35-abi3-manylinux2010_x86_64.whl -d application/lambda/auth/
          - python application/lambda/auth/setup.py install -t application/lambda/auth/
          - pip install -r application/lambda/auth/requirements.pip -t application/lambda/auth/
          - aws cloudformation package
                --s3-bucket=${BUILD_OUTPUT_BUCKET}
                --s3-prefix=${BUILD_OUTPUT_PREFIX}
                --template-file=application/template.yaml
                --output-template-file=application/packaged.yaml
artifacts:
    base-directory: ./application
    files:
      - packaged.yaml